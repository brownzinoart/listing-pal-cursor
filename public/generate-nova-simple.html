<!DOCTYPE html>
<html>
<head>
    <title>Generate Nova Demo</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 50px auto; 
            padding: 20px;
            background: #1e293b;
            color: white;
        }
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        button:hover { background: #4f46e5; }
        button:disabled { background: #64748b; cursor: not-allowed; }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .success { background: #22c55e; }
        .error { background: #ef4444; }
        .info { background: #3b82f6; }
        .loading { background: #f59e0b; }
    </style>
</head>
<body>
    <h1>üéôÔ∏è Generate Nova Demo with Audio</h1>
    
    <div id="status" class="status info">
        Ready to generate Nova demo with synced audio
    </div>
    
    <button id="generateBtn" onclick="generateNova()">üé¨ Generate Nova Demo with Audio</button>
    
    <div id="progress" style="display:none;">
        <div style="background: #475569; height: 10px; border-radius: 5px; overflow: hidden;">
            <div id="progressBar" style="background: #6366f1; height: 100%; width: 0%; transition: width 0.3s;"></div>
        </div>
    </div>

    <script>
        const statusEl = document.getElementById('status');
        const generateBtn = document.getElementById('generateBtn');
        const progressEl = document.getElementById('progress');
        const progressBar = document.getElementById('progressBar');
        
        const SCRIPT = `Welcome to this stunning Beverly Hills mansion featuring modern luxury amenities and breathtaking views. 
The grand living room features floor-to-ceiling windows with panoramic city views. 
This gourmet kitchen boasts custom Italian cabinetry and professional-grade appliances. 
The master suite offers a private terrace overlooking the canyon. 
Resort-style outdoor living with infinity pool and spa. 
Luxurious spa bathroom with imported marble finishes. 
This extraordinary estate is offered at $15,750,000. Schedule your private showing today.`;

        const imageUrls = [
            'https://images.unsplash.com/photo-1613490493576-7fde63acd811?auto=format&fit=crop&w=1920&h=1080&q=80',
            'https://images.unsplash.com/photo-1565538810643-b5bdb714032a?auto=format&fit=crop&w=1920&h=1080&q=80',
            'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?auto=format&fit=crop&w=1920&h=1080&q=80',
            'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?auto=format&fit=crop&w=1920&h=1080&q=80',
            'https://images.unsplash.com/photo-1600607687644-c7171b42498b?auto=format&fit=crop&w=1920&h=1080&q=80'
        ];
        
        async function generateNova() {
            generateBtn.disabled = true;
            progressEl.style.display = 'block';
            
            try {
                // Step 1: Generate Nova TTS
                statusEl.className = 'status loading';
                statusEl.textContent = 'üéôÔ∏è Generating Nova voice audio...';
                progressBar.style.width = '20%';
                
                const ttsResponse = await fetch('/api/generate-tts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: SCRIPT,
                        voice: 'nova',
                        speed: 1.0,
                        model: 'tts-1'
                    })
                });
                
                if (!ttsResponse.ok) {
                    throw new Error(`TTS failed: ${ttsResponse.status}`);
                }
                
                const ttsResult = await ttsResponse.json();
                
                if (!ttsResult.audioBase64) {
                    throw new Error('No audio generated');
                }
                
                console.log('‚úÖ Nova audio generated');
                progressBar.style.width = '50%';
                
                // Step 2: Generate video with Nova audio
                statusEl.textContent = 'üé¨ Creating video with Nova audio...';
                
                const videoResponse = await fetch('/api/generate-remotion-video', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        images: imageUrls,
                        audioUrl: ttsResult.audioBase64,
                        propertyInfo: {
                            address: '1245 Benedict Canyon Drive, Beverly Hills, CA 90210',
                            price: '$15,750,000',
                            beds: 7,
                            baths: 9,
                            sqft: 12500
                        },
                        platform: 'youtube',
                        imageDuration: 5,
                        transitionType: 'fade'
                    })
                });
                
                if (!videoResponse.ok) {
                    const errorText = await videoResponse.text();
                    throw new Error(`Video failed: ${videoResponse.status} - ${errorText}`);
                }
                
                const videoResult = await videoResponse.json();
                progressBar.style.width = '80%';
                
                if (videoResult.success && videoResult.videoUrl) {
                    statusEl.textContent = 'üíæ Video generated! Downloading...';
                    
                    // Step 3: Download the video
                    const downloadResponse = await fetch(videoResult.videoUrl);
                    const blob = await downloadResponse.blob();
                    
                    // Create download link
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = 'beverly-hills-nova.mp4';
                    a.click();
                    
                    progressBar.style.width = '100%';
                    statusEl.className = 'status success';
                    statusEl.textContent = 'üéâ SUCCESS! Nova video with audio downloaded. Save it to public/demo-videos/beverly-hills-nova.mp4';
                    
                } else {
                    throw new Error(videoResult.error || 'Video generation failed');
                }
                
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = '‚ùå Error: ' + error.message;
                console.error(error);
            } finally {
                generateBtn.disabled = false;
                setTimeout(() => {
                    progressEl.style.display = 'none';
                    progressBar.style.width = '0%';
                }, 2000);
            }
        }
    </script>
</body>
</html>