<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Studio Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #4f46e5;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .loading {
            background: #d1ecf1;
            color: #0c5460;
        }
        audio {
            width: 100%;
            margin: 10px 0;
        }
        video {
            width: 100%;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Video Studio Complete Workflow Test</h1>
    
    <div class="test-section" style="background: #fef3c7; border: 1px solid #f59e0b;">
        <h3 style="color: #92400e;">⚠️ Important Note</h3>
        <p style="color: #92400e;">The Remotion video service requires image URLs (not data URLs). Images must be accessible via HTTP/HTTPS.</p>
        <p style="color: #92400e;">This test uses Unsplash images as placeholders. In production, use your Cloudinary URLs.</p>
    </div>

    <div class="test-section">
        <h2>1. Voice Preview Test</h2>
        <p>Test OpenAI TTS voice preview functionality</p>
        
        <div>
            <button onclick="testVoicePreview('nova')">Test Nova Voice</button>
            <button onclick="testVoicePreview('echo')">Test Echo Voice</button>
            <button onclick="testVoicePreview('fable')">Test Fable Voice</button>
        </div>
        
        <div id="voice-status"></div>
        <audio id="voice-audio" controls style="display:none"></audio>
    </div>

    <div class="test-section">
        <h2>2. Video Generation Test</h2>
        <p>Test Remotion video generation with property data</p>
        
        <button onclick="testVideoGeneration()">Generate Test Video</button>
        
        <div id="video-status"></div>
        <video id="generated-video" controls style="display:none"></video>
    </div>

    <div class="test-section">
        <h2>3. Complete Workflow Test</h2>
        <p>Test full video generation with voiceover</p>
        
        <button onclick="testCompleteWorkflow()">Run Complete Workflow</button>
        
        <div id="workflow-status"></div>
        <div id="workflow-results"></div>
    </div>

    <script>
        // Test voice preview
        async function testVoicePreview(voice) {
            const statusEl = document.getElementById('voice-status');
            const audioEl = document.getElementById('voice-audio');
            
            statusEl.className = 'status loading';
            statusEl.textContent = `Testing ${voice} voice...`;
            
            try {
                const response = await fetch('/api/generate-tts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: "Welcome to this stunning Beverly Hills mansion featuring modern luxury amenities and breathtaking views.",
                        voice: voice,
                        speed: 1.0,
                        model: 'tts-1'
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.success && result.audioBase64) {
                    statusEl.className = 'status success';
                    statusEl.textContent = `✓ ${voice} voice generated successfully!`;
                    
                    audioEl.src = result.audioBase64;
                    audioEl.style.display = 'block';
                    audioEl.play();
                } else {
                    throw new Error(result.error || 'Unknown error');
                }
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = `✗ Error: ${error.message}`;
            }
        }

        // Test video generation
        async function testVideoGeneration() {
            const statusEl = document.getElementById('video-status');
            const videoEl = document.getElementById('generated-video');
            
            statusEl.className = 'status loading';
            statusEl.textContent = 'Generating video...';
            
            try {
                // Use test images from a reliable source
                const images = [
                    'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=1920&h=1080&fit=crop',
                    'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=1920&h=1080&fit=crop',
                    'https://images.unsplash.com/photo-1600607687644-c7171b42498b?w=1920&h=1080&fit=crop'
                ];

                statusEl.textContent = 'Sending request to generate video...';

                const response = await fetch('/api/generate-remotion-video', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        images: images,
                        propertyInfo: {
                            address: "1245 Benedict Canyon Drive, Beverly Hills, CA 90210",
                            price: "$15,750,000",
                            beds: 7,
                            baths: 9,
                            sqft: 12500
                        },
                        platform: "youtube",
                        imageDuration: 3,
                        transitionType: "fade"
                    })
                });

                const responseText = await response.text();
                console.log('Response:', responseText);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}, response: ${responseText}`);
                }

                const result = JSON.parse(responseText);
                
                if (result.success && result.videoUrl) {
                    statusEl.className = 'status success';
                    statusEl.textContent = '✓ Video generated successfully!';
                    
                    // Add timestamp to prevent caching
                    videoEl.src = result.videoUrl + '?t=' + Date.now();
                    videoEl.style.display = 'block';
                    
                    // Log the video URL
                    console.log('Video URL:', result.videoUrl);
                } else {
                    throw new Error(result.error || 'Unknown error');
                }
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = `✗ Error: ${error.message}`;
                console.error('Video generation error:', error);
            }
        }

        // Test complete workflow
        async function testCompleteWorkflow() {
            const statusEl = document.getElementById('workflow-status');
            const resultsEl = document.getElementById('workflow-results');
            
            statusEl.className = 'status loading';
            statusEl.textContent = 'Starting complete workflow...';
            resultsEl.innerHTML = '';
            
            try {
                // Step 1: Generate voice narration
                statusEl.textContent = 'Step 1/3: Generating voiceover...';
                
                const scriptText = `Welcome to this stunning luxury estate at 1245 Benedict Canyon Drive in Beverly Hills. 
                    This magnificent 7 bedroom, 9 bathroom home offers 12,500 square feet of pure elegance. 
                    Step into the grand living room where a floating glass staircase with LED lighting creates a dramatic centerpiece. 
                    The gourmet kitchen features a Chef's kitchen with La Cornue range and Sub-Zero appliances. 
                    This exceptional estate is offered at $15,750,000. Don't miss this rare opportunity.`;
                
                const ttsResponse = await fetch('/api/generate-tts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: scriptText,
                        voice: 'nova',
                        speed: 1.0,
                        model: 'tts-1'
                    })
                });

                if (!ttsResponse.ok) {
                    throw new Error('Failed to generate voiceover');
                }

                const ttsResult = await ttsResponse.json();
                
                // Step 2: Use property images from Unsplash
                statusEl.textContent = 'Step 2/3: Loading property images...';
                
                // Use high-quality property images from Unsplash
                const images = [
                    'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=1920&h=1080&fit=crop', // Exterior
                    'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=1920&h=1080&fit=crop', // Living room
                    'https://images.unsplash.com/photo-1600607687644-c7171b42498b?w=1920&h=1080&fit=crop', // Kitchen
                    'https://images.unsplash.com/photo-1600607687920-4e2a09cf159d?w=1920&h=1080&fit=crop', // Bedroom
                    'https://images.unsplash.com/photo-1600607687644-aac4c3eac7f4?w=1920&h=1080&fit=crop'  // Pool
                ];
                
                // Step 3: Generate video
                statusEl.textContent = 'Step 3/3: Generating video with voiceover...';
                
                const videoResponse = await fetch('/api/generate-remotion-video', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        images: images,
                        audioUrl: ttsResult.audioBase64,
                        propertyInfo: {
                            address: "1245 Benedict Canyon Drive, Beverly Hills, CA 90210",
                            price: "$15,750,000",
                            beds: 7,
                            baths: 9,
                            sqft: 12500
                        },
                        platform: "youtube",
                        imageDuration: 5
                    })
                });

                if (!videoResponse.ok) {
                    throw new Error('Failed to generate video');
                }

                const videoResult = await videoResponse.json();
                
                statusEl.className = 'status success';
                statusEl.textContent = '✓ Complete workflow successful!';
                
                resultsEl.innerHTML = `
                    <h3>Results:</h3>
                    <p><strong>Voiceover:</strong> Generated with Nova voice</p>
                    <audio controls src="${ttsResult.audioBase64}"></audio>
                    <p><strong>Video:</strong> Generated with ${images.length} scenes</p>
                    <video controls src="${videoResult.videoUrl}"></video>
                `;
                
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = `✗ Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>