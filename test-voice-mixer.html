<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo Video Voice Mixer Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #1e293b;
        color: white;
      }
      .container {
        background: #334155;
        padding: 30px;
        border-radius: 12px;
        margin: 20px 0;
      }
      .voice-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }
      .voice-card {
        background: #475569;
        padding: 20px;
        border-radius: 8px;
        transition: all 0.3s;
        cursor: pointer;
        border: 2px solid transparent;
      }
      .voice-card:hover {
        background: #64748b;
        transform: translateY(-2px);
      }
      .voice-card.selected {
        border-color: #6366f1;
        background: #4f46e5;
      }
      .voice-info {
        margin: 10px 0;
      }
      .voice-name {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 5px;
      }
      .voice-desc {
        font-size: 14px;
        color: #cbd5e1;
      }
      button {
        background: #6366f1;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
      }
      button:hover {
        background: #4f46e5;
      }
      button:disabled {
        background: #64748b;
        cursor: not-allowed;
      }
      video {
        width: 100%;
        max-width: 800px;
        margin: 20px auto;
        display: block;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      }
      .progress-bar {
        width: 100%;
        height: 8px;
        background: #475569;
        border-radius: 4px;
        overflow: hidden;
        margin: 20px 0;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(to right, #6366f1, #a855f7);
        transition: width 0.3s;
      }
      .status {
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        text-align: center;
      }
      .status.loading {
        background: #3b82f6;
      }
      .status.success {
        background: #22c55e;
      }
      .status.error {
        background: #ef4444;
      }
      .status.info {
        background: #6366f1;
      }
    </style>
  </head>
  <body>
    <h1>ðŸŽ¬ Demo Video Voice Mixer Test</h1>

    <div class="container">
      <h2>Select a Voice for the Beverly Hills Demo</h2>

      <div class="voice-grid">
        <div class="voice-card" data-voice="nova">
          <div class="voice-name">Nova</div>
          <div class="voice-desc">
            Professional female voice - Clear and engaging
          </div>
        </div>
        <div class="voice-card" data-voice="alloy">
          <div class="voice-name">Alloy</div>
          <div class="voice-desc">
            Balanced versatile voice - Natural and warm
          </div>
        </div>
        <div class="voice-card" data-voice="echo">
          <div class="voice-name">Echo</div>
          <div class="voice-desc">
            Authoritative male voice - Strong and confident
          </div>
        </div>
        <div class="voice-card" data-voice="fable">
          <div class="voice-name">Fable</div>
          <div class="voice-desc">
            British storytelling voice - Warm and engaging
          </div>
        </div>
        <div class="voice-card" data-voice="onyx">
          <div class="voice-name">Onyx</div>
          <div class="voice-desc">
            Deep resonant male voice - Rich and powerful
          </div>
        </div>
        <div class="voice-card" data-voice="shimmer">
          <div class="voice-name">Shimmer</div>
          <div class="voice-desc">
            Bright energetic female voice - Lively and expressive
          </div>
        </div>
      </div>

      <div style="text-align: center; margin: 30px 0">
        <button id="generate-btn" disabled>Select a Voice First</button>
        <button id="cache-btn">Pre-cache Popular Voices</button>
      </div>

      <div id="status"></div>

      <div class="progress-bar" style="display: none">
        <div class="progress-fill" id="progress"></div>
      </div>

      <video id="demo-video" controls style="display: none">
        Your browser does not support the video tag.
      </video>
    </div>

    <script type="module">
      let selectedVoice = null;
      const voiceCards = document.querySelectorAll(".voice-card");
      const generateBtn = document.getElementById("generate-btn");
      const cacheBtn = document.getElementById("cache-btn");
      const statusEl = document.getElementById("status");
      const progressBar = document.querySelector(".progress-bar");
      const progressFill = document.getElementById("progress");
      const videoEl = document.getElementById("demo-video");

      // Voice selection
      voiceCards.forEach((card) => {
        card.addEventListener("click", () => {
          voiceCards.forEach((c) => c.classList.remove("selected"));
          card.classList.add("selected");
          selectedVoice = card.dataset.voice;
          generateBtn.disabled = false;
          generateBtn.textContent = `Generate Demo with ${selectedVoice.charAt(0).toUpperCase() + selectedVoice.slice(1)} Voice`;
        });
      });

      // Generate video with selected voice
      generateBtn.addEventListener("click", async () => {
        if (!selectedVoice) return;

        generateBtn.disabled = true;
        cacheBtn.disabled = true;
        progressBar.style.display = "block";
        videoEl.style.display = "none";

        try {
          // Import services
          const { demoVideoService } = await import(
            "./services/demoVideoService.ts"
          );

          statusEl.className = "status loading";
          statusEl.textContent = `Preparing demo with ${selectedVoice} voice...`;
          progressFill.style.width = "0%";

          // Get demo video
          const videoResult = await demoVideoService.getDemoVideo(
            "beverly-hills-mansion",
            selectedVoice,
            (progress, message) => {
              progressFill.style.width = `${progress}%`;
              statusEl.textContent = message;
            },
          );

          // Display video
          videoEl.src = videoResult.masterVideoUrl + "?t=" + Date.now();
          videoEl.style.display = "block";

          statusEl.className = "status success";
          statusEl.textContent = `âœ“ Demo video ready with ${selectedVoice} voice!`;

          console.log("Video Result:", videoResult);
        } catch (error) {
          statusEl.className = "status error";
          statusEl.textContent = `âœ— Error: ${error.message}`;
          console.error("Error:", error);
        } finally {
          generateBtn.disabled = false;
          cacheBtn.disabled = false;
          progressBar.style.display = "none";
        }
      });

      // Pre-cache popular voices
      cacheBtn.addEventListener("click", async () => {
        cacheBtn.disabled = true;
        generateBtn.disabled = true;

        try {
          const { demoVideoMixerService } = await import(
            "./services/demoVideoMixerService.ts"
          );

          statusEl.className = "status info";
          statusEl.textContent =
            "Pre-caching popular voices (Nova and Echo)...";

          await demoVideoMixerService.preCachePopularVoices(["nova", "echo"]);

          statusEl.className = "status success";
          statusEl.textContent = "âœ“ Popular voices cached successfully!";

          // Show cache stats
          const stats = demoVideoMixerService.getCacheStats();
          console.log("Cache Stats:", stats);
        } catch (error) {
          statusEl.className = "status error";
          statusEl.textContent = `âœ— Error: ${error.message}`;
        } finally {
          cacheBtn.disabled = false;
          generateBtn.disabled = selectedVoice === null;
        }
      });

      // Auto-select Nova on load
      window.addEventListener("load", () => {
        const novaCard = document.querySelector('[data-voice="nova"]');
        if (novaCard) {
          novaCard.click();
        }
      });
    </script>
  </body>
</html>
